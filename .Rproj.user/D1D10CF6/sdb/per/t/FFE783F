{
    "collab_server" : "",
    "contents" : "% Generated by roxygen2: do not edit by hand\n% Please edit documentation in R/biasCorrect(generic).R\n\\docType{methods}\n\\name{biasCorrect}\n\\alias{biasCorrect}\n\\alias{biasCorrect,data.frame,data.frame,data.frame-method}\n\\alias{biasCorrect,list,list,list-method}\n\\title{Biascorrect the input timeseries or hyfo dataset}\n\\usage{\nbiasCorrect(frc, hindcast, obs, method = \"scaling\", scaleType = \"multi\",\n  preci = FALSE, prThreshold = 0, extrapolate = \"no\")\n\n\\S4method{biasCorrect}{data.frame,data.frame,data.frame}(frc, hindcast, obs,\n  method = \"scaling\", scaleType = \"multi\", preci = FALSE,\n  prThreshold = 0, extrapolate = \"no\")\n\n\\S4method{biasCorrect}{list,list,list}(frc, hindcast, obs, method = \"scaling\",\n  scaleType = \"multi\", preci = FALSE, prThreshold = 0,\n  extrapolate = \"no\")\n}\n\\arguments{\n\\item{frc}{a hyfo grid data output or a dataframe (time series) consists of Date column and one or more value columns, \nrepresenting the forecast to be calibrated.}\n\n\\item{hindcast}{a hyfo grid data output or a dataframe(time series) consists of Date column and one or more value columns, \nrepresenting the hindcast data. This data will be used in the calibration of the forecast, so it's better to have the same date period as\nobservation data. Check details for more information.}\n\n\\item{obs}{a hyfo grid data output or a dataframe (time series) consists of Date column and one or more value columns, \nrepresenting the observation data.}\n\n\\item{method}{bias correct method, including 'delta', 'scaling'..., default is 'scaling'}\n\n\\item{scaleType}{only when the method \"scaling\" is chosen, scaleType will be available. Two different types\nof scaling method, 'add' and 'multi', which means additive and multiplicative scaling method. More info check \ndetails. Default scaleType is 'multi'.}\n\n\\item{preci}{If the precipitation is biascorrected, then you have to assign \\code{preci = TRUE}. Since for\nprecipitation, some biascorrect methods may not apply to, or some methods are specially for precipitation. \nDefault is FALSE, refer to details.}\n\n\\item{prThreshold}{The minimum value that is considered as a non-zero precipitation. Default to 1 (assuming mm).}\n\n\\item{extrapolate}{When use 'eqm' method, and 'no' is set, modified frc is bounded by the range of obs.\nIf 'constant' is set, modified frc is not bounded by the range of obs. Default is 'no'.}\n}\n\\description{\nBiascorrect the input time series or dataset, the input time series or dataset should consist of observation, hindcast, and forecast.\nobservation and hindcast should belong to the same period, in order to calibrate. Then the modified forecast\nwill be returned. If the input is a time series, first column should be date column and rest columns should be \nthe value column. If the input is a hyfo dataset, the dataset should be the result of \\code{loadNcdf}, or a list\nfile with the same format.\n}\n\\details{\nSince climate forecast is based on global condition, when downscaling to different regions, it may include\nsome bias, biascorrection is used then to fix the bias.\n\n\\strong{Hindcast}\n\nIn order to bias correct, we need to pick up some data from the forecast to train with\nthe observation, which is called hindcast in this function. Using hindcast and observation, \nthe program can analyze the bias and correct the bias in the forecast. \n\nHindcast should have \\strong{EVERY} attributes that forecast has.\n\nHindcast is also called re-forecast, is the forecast of the past. E.g. you have a forecast from year 2000-2010, assuming now you are in 2005. So from 2000-2005, this period\nis the hindcast period, and 2005-2010, this period is the forecast period.\n\nHindcast can be the same as forecast, i.e., you can use forecast itself as hindcast to train the bias correction.\n\n\n\\strong{How it works}\n\nForecast product has to be calibrated, usually the system is doing forecast in real time. So, e.g., if the \nforecast starts from year 2000, assuming you are in year 2003, then you will have 3 years' hindcast \ndata (year 2000-2003), which can be used to calibrate. And your forecast period is (2003-2004)\n\nE.g. you have observation from 2001-2002, this is your input obs. Then you can take the same \nperiod (2001-2002) from the forecast, which is the hindcast period. For forecast, you can take any period.\nThe program will evaluate the obs and hindcast, to get the modification of the forecast, and then add the \nmodification to the forecast data.\n\nThe more categorized input, the more accurate result you will get. E.g., if you want to \nbias correct a forecast for winter season. So you'd better to extract all the winter period\nin the hindcast and observation to train. \\code{extractPeriod} can be used for this purpose.\n\n\\strong{method}\n\nDifferent methods used in the bias correction. Among which, delta, scaling can be applied\nto different kinds of parameters, with no need to set \\code{preci}; eqm has two conditions for rainfall data and other data,\nit needs user to input \\code{preci = TRUE/FALSE} to point to different conditions; gqm is\ndesigned for rainfall data, so \\code{preci = TRUE} needs to be set.\n\n\\strong{delta}\n\nThis method consists on adding to the observations the mean change signal (delta method). \nThis method is applicable to any kind of variable but it is preferable to avoid it for bounded variables\n (e.g. precipitation, wind speed, etc.) because values out of the variable range could be obtained \n (e.g. negative wind speeds...)\n \n\\strong{scaling}\n \nThis method consists on scaling the simulation  with the difference (additive) or quotient (multiplicative) \nbetween the observed and simulated means in the train period. The \\code{additive} or \\code{multiplicative}\ncorrection is defined by parameter \\code{scaling.type} (default is \\code{additive}).\nThe additive version is preferably applicable to unbounded variables (e.g. temperature) \nand the multiplicative to variables with a lower bound (e.g. precipitation, because it also preserves the frequency). \n \n \\strong{eqm}\n \nEmpirical Quantile Mapping. This is a very extended bias correction method which consists on calibrating the simulated Cumulative Distribution Function (CDF) \nby adding to the observed quantiles both the mean delta change and the individual delta changes in the corresponding quantiles. \nThis method is applicable to any kind of variable.\n\nIt can keep the extreme value, if you choose constant extrapolation method. But then you will face the risk\nthat the extreme value is an error.\n \n \\strong{gqm}\n \nGamma Quantile Mapping. This method is described in Piani et al. 2010 and is applicable only to precipitation. It is based on the initial assumption that both observed\nand simulated intensity distributions are well approximated by the gamma distribution, therefore is a parametric q-q map \nthat uses the theorical instead of the empirical distribution. \n \nIt can somehow filter some extreme values caused by errors, while keep the extreme value. Seems more reasonable.\nBetter have a long period of training, and the if the forecast system is relatively stable.\n\nIt is a generic function, if in your case you need to debug, please see \\code{?debug()} \nfor how to debug S4 method.\n}\n\\examples{\n\n######## hyfo grid file biascorrection\n########\n\n# If your input is obtained by \\\\code{loadNcdf}, you can also directly biascorrect\n# the file.\n\n# First load ncdf file.\nfilePath <- system.file(\"extdata\", \"tnc.nc\", package = \"hyfo\")\nvarname <- getNcdfVar(filePath)    \nnc <- loadNcdf(filePath, varname)\n\ndata(tgridData)\n# Since the example data, has some NA values, the process will include some warning #message, \n# which can be ignored in this case.\n\n\n\n\n# Then we will use nc data as forecasting data, and use itself as hindcast data,\n# use tgridData as observation.\nnewFrc <- biasCorrect(nc, nc, tgridData)  \nnewFrc <- biasCorrect(nc, nc, tgridData, scaleType = 'add')   \nnewFrc <- biasCorrect(nc, nc, tgridData, method = 'eqm', extrapolate = 'constant', \npreci = TRUE) \nnewFrc <- biasCorrect(nc, nc, tgridData, method = 'gqm', preci = TRUE) \n\n\n######## Time series biascorrection\n########\n\n# Use the time series from testdl as an example, we take frc, hindcast and obs from testdl.\ndata(testdl)\n\n# common period has to be extracted in order to better train the forecast.\n\ndatalist <- extractPeriod(testdl, startDate = '1994-1-1', endDate = '1995-10-1')\n\nfrc <- datalist[[1]]\nhindcast <- datalist[[2]]\nobs <- datalist[[3]]\n\n\n# The data used here is just for example, so there could be negative data.\n\n# default method is scaling, with 'multi' scaleType\nfrc_new <- biasCorrect(frc, hindcast, obs)\n\n# for precipitation data, extra process needs to be executed, so you have to tell\n# the program that it is a precipitation data.\n\nfrc_new1 <- biasCorrect(frc, hindcast, obs, preci = TRUE)\n\n# You can use other scaling methods to biascorrect.\nfrc_new2 <- biasCorrect(frc, hindcast, obs, scaleType = 'add')\n\n# \nfrc_new3 <- biasCorrect(frc, hindcast, obs, method = 'eqm', preci = TRUE)\nfrc_new4 <- biasCorrect(frc, hindcast, obs, method = 'gqm', preci = TRUE)\n\nplotTS(obs, frc, frc_new, frc_new1, frc_new2, frc_new3, frc_new4, plot = 'cum')\n\n# You can also give name to this input list.\nTSlist <- list(obs, frc, frc_new, frc_new1, frc_new2, frc_new3, frc_new4)\nnames(TSlist) <- c('obs', 'frc', 'delta', 'delta_preci', 'scale', 'eqm', 'gqm')\nplotTS(list = TSlist, plot = 'cum')\n\n\n# If the forecasts you extracted only has incontinuous data for certain months and years, e.g.,\n# for seasonal forecasting, forecasts only provide 3-6 months data, so the case can be \n# for example Dec, Jan and Feb of every year from year 1999-2005.\n# In such case, you need to extract certain months and years from observed time series.\n# extractPeriod() can be then used.\n  \n  \n\n\n\n# More examples can be found in the user manual on http://yuanchao-xu.github.io/hyfo/\n\n\n}\n\\author{\nYuanchao Xu \\email{xuyuanchao37@gmail.com }\n}\n\\references{\nBias correction methods come from \\code{biasCorrection} from \\code{dowscaleR}\n\n\\itemize{\n\n\\item Santander Meteorology Group (2015). downscaleR: Climate data manipulation and statistical downscaling. R\npackage version 0.6-0. https://github.com/SantanderMetGroup/downscaleR/wiki\n\n\\item R.A.I. Wilcke, T. Mendlik and A. Gobiet (2013) Multi-variable error correction of regional climate models. Climatic Change, 120, 871-887\n\n\\item A. Amengual, V. Homar, R. Romero, S. Alonso, and C. Ramis (2012) A Statistical Adjustment of Regional Climate Model Outputs to Local Scales: Application to Platja de Palma, Spain. J. Clim., 25, 939-957\n\n\\item C. Piani, J. O. Haerter and E. Coppola (2009) Statistical bias correction for daily precipitation in regional climate models over Europe, Theoretical and Applied Climatology, 99, 187-192\n\n\\item O. Gutjahr and G. Heinemann (2013) Comparing precipitation bias correction methods for high-resolution regional climate simulations using COSMO-CLM, Theoretical and Applied Climatology, 114, 511-529\n}\n}\n\n",
    "created" : 1483875745269.000,
    "dirty" : false,
    "encoding" : "ASCII",
    "folds" : "",
    "hash" : "1881246410",
    "id" : "FFE783F",
    "lastKnownWriteTime" : 1487594221,
    "last_content_update" : 1487594221,
    "path" : "~/GitHub/hyfo/man/biasCorrect.Rd",
    "project_path" : "man/biasCorrect.Rd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_doc"
}