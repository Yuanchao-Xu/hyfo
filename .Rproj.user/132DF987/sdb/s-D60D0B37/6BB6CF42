{
    "contents" : "library(hyfo)\nlibrary(reshape2)\nlibrary(ggplot2)\nrequire(ecomsUDG.Raccess)\nloginECOMS_UDG(\"Yuanchao\",\"abcd1234\")\nlibrary(downscaleR)\n\n############################# Weighed Rainfall Extended streamflow ###########################\n\n# calculating the mean precipitation on the catchment. since in each catchment, the rainfall is\n#weighted\n\na <- dget(file.choose())\na2 <- extractPeriod(a, comm = T)\na3 <- list2Dataframe(a2)\na3 <- fillGap(a3)\n\nDCAT1 <- 0.111 * a3[2] + 0.124 * a3[3] + 0.542 * a3[6] + 0.227 * a3[4] + 0.166 * a3[5]\nANA <- 0.265 * a3[2] + 0.782 * a3[3]\nDCAT2 <- 0.111 * a3[2] + 0.124 * a3[3] + 0.542 * a3[6] + 0.227 * a3[4] + 0.166 * a3[5]\nERE <- 0.111 * a3[2] + 0.124 * a3[3] + 0.542 * a3[6] + 0.227 * a3[4] + 0.166 * a3[5]\nDSC <- 0.111 * a3[2] + 0.124 * a3[3] + 0.542 * a3[6] + 0.227 * a3[4] + 0.166 * a3[5]\n\ntotalPre <- (DCAT1 * 1.65 + ANA * 48.85 + DCAT2 * 12.11 + ERE * 152.17 + DSC * 56.98) / \n  (1.65 + 48.85 + 12.11 + 152.17 + 56.98)\n\n\ntotalPre <- data.frame(Date = a3[1], value = totalPre)\ncolnames(totalPre) <- c('Date', 'value')\n\ngetAnnual_dataframe(totalPre)\n\n\n# plot the mean rainfall\\\nyear <- format(totalPre[1], format = '%Y')\nmon <- format(totalPre[1], format = '%m')\n\nb <- getMeanPreci(totalPre[, 2], method = 'annual', year = year, mon = mon, full = T, omitNA = T,\n                  plot = T)\n# so the dry year is 2001, wet year is 2013.\n\n\n# Analysis for dry year and wet year.\n# First take ensemble\n\ndry <- getHisEnsem(totalPre, example = c('2001-1-1', '2001-12-31'), buffer = 30)\nwet <- getHisEnsem(totalPre, example = c('2013-1-1', '2013-12-31'), buffer = 30)\n\ndry_cum <- data.frame(Date = dry$Date, cumsum(dry[2:ncol(dry)]))\nwet_cum <- data.frame(Date = wet$Date, cumsum(wet[2:ncol(wet)]))\n\ndry_ggplot <- melt(dry_cum, id.var = 'Date')\ndry_example <- dry_cum[c(1,5)]\n# This is used to distinguish example and the rest\n#dry_ggplot$example <- as.character(dry_ggplot$variable)\n#dry_ggplot$example[dry_ggplot$example != 'X2001.01.01' ] <- 'members'\n# \n\nwet_ggplot <- melt(wet_cum, id.var = 'Date')\n\n\n\n# change subset to see dry years and wet years.\nggplot(wet_ggplot) +\n  aes(x = Date, y = value, color = variable, group = variable) +\n  geom_line() +\n  geom_line(size = 2, data = wet_ggplot[wet_ggplot$variable == 'X2013.01.01', ])\n  \n\ncomb <- rbind(dry_ggplot, wet_ggplot)\n\nggplot(totalPre) +\n  aes(x = Date, y = value) +\n  geom_line()\n\n#####################################  system4 ############################################\n\n### bias correction???###\n\nfrc <- loadECOMS(dataset = \"System4_seasonal_15\", var = \"tp\", members = 1:3, \n                 lonLim = c(-2.4,-1.5), latLim = c(42.8,44.5), season = c(12,1,2), years = 1999:2003, leadMonth = 2, time = \"DD\")\nobs <- loadECOMS(dataset = \"WFDEI\", var = \"tp\", members = 1:5, \n                 lonLim = c(-2.4,-1.5), latLim = c(42.8,44.5), season = c(12,1,2), years = 1999:2008, leadMonth = 2, time = \"DD\")\n# Since frc grid is larger, so used as new grid.\nobs1 <- interpGridData(obs, new.grid = getGrid(frc))\nfrc1 <- biasCorrection(obs1, frc, frc, method = 'unbiasing')\n\n##################################### ESP PLOT ##############################################\n\nana <- read.table(\"C:\\\\DHI_Projects\\\\11811405\\\\Seasonal_Forecasting\\\\Data\\\\From_website_realtime\\\\Catchment_stations\\\\ANARBE_D1W1\\\\Discharge.txt\",\n                  sep = ',')\n\nere <- read.table(\"C:\\\\DHI_Projects\\\\11811405\\\\Seasonal_Forecasting\\\\Data\\\\From_website_realtime\\\\Catchment_stations\\\\Ere??ozu D2W1\\\\Discharge.txt\",\n                  sep = ',')\n\n###### generate different ensembles.\n\nstart <- seq(as.Date('2003-1-1'), length = 6, by = '1 month')\nend <- seq(as.Date('2003-6-1'), length = 6, by = '1 month')\n\ndata <- mapply(function(x, y) getHisEnsem(ana, example = c(x, y)), start, end, SIMPLIFY = F)\n\ndata <- do.call('rbind', data)\n\na <- ggplot(data) + \n  geom_line(aes(x = Date, y = value, colour = variable)) + \n  facet_grid(name~ .)\nprint(a)\n\n#################################### Monthly Preci #####################################\n\nb <- loadGridData(filePath, \"pr\", year = 2005:2007,latLim= c(36,43.8) , lonLim=c(-9.2,4.4) , season = NULL, dictionary=FALSE)\nbMon <- lapply(1:12, function(x) getPreciBar(b, x, output = 'ggplot'))\ngetPreciBar_comb(bMon, nrow = 3)\n",
    "created" : 1437680807606.000,
    "dirty" : false,
    "encoding" : "ASCII",
    "folds" : "",
    "hash" : "1088089200",
    "id" : "6BB6CF42",
    "lastKnownWriteTime" : 1438086928,
    "path" : "C:/DHI_Projects/11811405/Seasonal_Forecasting/R/Data_Analysis/Analysis.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}