{
    "contents" : "###Start\n\n\n#Written by Yuanchao XU, email: xuyuanchao37@gmail.com, xyc@dhigroup.com\n#\n#Version 1.2\n#Updates : 1.with the ability to add catchemnt shape to the map\n#          2.more functions are added to the map function, mean,sum,...\n#          3.improvements about calculation\n#\n#Tips\n#\n#1. All the #####libraries##### needed must be #####installed##### first, and click yes on the \n#   pop-up window during the installation. if the error comes no function found, the problem must be\n#   within the libraries or the functions existing in main.R\n#2. The format of the dataset should be the same with the dataset in Euporias\n#3. This code only suits for the Euporias Project, for other uses, it may not work\n#4. Main library is ecomosUDG.Raccess and downscaleR\n#5. Main program is in the file Data_Analysis, and in the 'load source file' part, file has to be set correctly\n#6. More detailed instructions can be found on github about those two libraries.\n#7. When using loadGridData(), if lon or lat, has to vary from negative to positive, e.g. c(-3,2), and if error \n#   comes out, try to reinstall(rJava)package.Note: do not install first, once encounter an error, install rJava\n\n\n\n\n\n\n#Load Source File\n#############################################################################################################################\n\n\nsource(\"C:\\\\DHI_Projects\\\\Seasonal_Forecasting\\\\R\\\\Data_Analysis\\\\Main.R\")\nloginECOMS_UDG(\"ber\",\"AgernAlle5\")#log in the forecast data\n\n\n#Main Variables and Initial Conditions\n############################################################################################################################\n#all the variables will be stored in an environment called 'Variables'\n\n\nVariables <- new.env()\n\n\n#research area\n#before this step, spain02Files has to be checked to relate the index and the related file. \n#dataInventory() can finish the job, telling you more about the dataset\n#testData=loadGridData(spain02Files[3], \"tasmax\", latLim=c(30, 45), lonLim=c(-9, 10), dictionary=FALSE, years=2000)\n\n\n\n\"\nIf you want to have a look at the whole area, use function getDataRange as below\ndataRange <- getDataRange(spain02Files[2])\nextLon <- c(dataRange[1],dataRange[2])\nextLat <- c(dataRange[3],dataRange[4])\n\"\n\n# extLon <- c(-2.02,-1.75) # extraction area, you cannot do it from negative value to positive value, 0 should be one of the boundary\n# extLat <- c(43.07,43.33) # extraction area\n#for whole spain\nassign ('extLon', c(-9.2,4.4), env = Variables)\nassign ('extLat', c(36,43.8), env = Variables)\n#extLon <- c(-9.2,-0.1)\n#extLat <- c(36,43)\n\n\n#monthly precipitation dataset, store precipitation each month of each year in the dataset\n\nassign ('monthlyDataset', NULL, env = Variables)\n\n#time\nassign('startTime', NULL, env = Variables)\nassign('yearIndex', NULL, env = Variables)\nassign('monthIndex', NULL, env = Variables)\n\n#observed dataset\nassign('spain02Pr', NULL, env = Variables) \n\n\n#store the catchment shape file\nassign('catchment', NULL, env = Variables) \n\n#forecast dataset\n#forePr <- NULL\n\n#research area for plot precipitation, focus on certain cell\n#loc <- c(25,25)\n\n\n\n\n#Loadlibraries\n#############################################################################################################################\nrequire(gWidgets)\nrequire(gWidgetsRGtk2)\n\n\n\n#GUI Functions\n#############################################################################################################################\n\n#File\n###########\n\nloadData <- function(h,...){\n  filePath <- file.choose()\n  #when loading data, mind the period of year, especially for some year-crossing sesonal calculation like winter(12,1,2)\n  Variables$spain02Pr <- loadGridData(filePath, \"pr\", year = NULL,latLim=extLat, lonLim=extLon, dictionary=FALSE)\n  \n  #after loading the file, some general variables are set to be global\n  Variables$startTime <- as.POSIXlt(dataset$Dates$start,tz = 'GMT')\n  Variables$yearIndex <- startTime$year + 1900\n  Variables$monthIndex <- startTime$mon + 1\n  Variables$matrixData\n  #print (getDataRange(filePath))\n}\n\nloadCatchment <- function(h,...){\n  filePath <- file.choose()\n  catName <- tail(strsplit(filePath,'\\\\\\\\')[[1]],1)#needs to be four \\, caused by some window system problem\n  catName1 <- strsplit(catName,'\\\\.')[[1]][1]\n  catName2 <- paste('\\\\\\\\',catName, sep = '')\n  folderName <- strsplit(filePath,catName2)[[1]]\n  Variables$catchment <- readOGR(folderName,catName1)\n}\n\nloadFore <- function(h,...){\n  forePr <- loadECOMS(dataset = \"System4_seasonal_15\", var = \"tp\", members = 1, \n                      lonLim = extLon, latLim = extLat, season = 1:6, years = NULL, leadMonth = 1, time = \"DD\")\n}\n\n#Map\n############\n\nMeanSeasonal_Ob <- function(h,...) getSpatialMap(Variables$spain02Pr,Variables$catchment,method = 'meanSeasonalPreci')\nMaxSpatialMap_Ob <- function(h,...) getSpatialMap(Variables$spain02Pr,Variables$catchment,method = 'max')\nMeanAnnual_Ob <- function(h,...) getSpatialMap(Variables$spain02Pr,Variables$catchment,method = 'meanAnnualPreci')\n\nSpatialMap_Fo <- function(h,...) getSpatialMap(forePr,Variables$catchment,method = 'mean')\n\n\n#Plot ##############################needs improvement with variables\n############\n\nDPreci_Ob <- function(h,...) plotPrecTS(Variables$spain02Pr,loc = NULL,method = NULL)\nAMPreci_Ob <- function(h,...) plotPrecTS(Variables$spain02Pr,loc = loc,method = 'annualMean')\nASPreci_Ob <- function(h,...) plotPrecTS(Variables$spain02Pr,loc = NULL,method = 'annualSum')\nAMaxPreci_Ob <- function(h,...) plotPrecTS(Variables$spain02Pr,loc = NULL,method = 'annualMax')\n\nDPreci_Fr <- function(h,...) plotPrecTS(forePr,loc = NULL,method = NULL)\n\n\n\n#GUI\n#############################################################################################################################\n\nbackground <- gwindow('Data Analysis 1.1')\n\n# toolbarList <- list(\n#   loadData = list(handler=loadData, icon=\"open\"),\n#   loadCatchment = list(handler=f, icon=\"open\"),\n#   quit = list(handler=f, icon=\"close\")\n# )\n# gtoolbar(toolbarList, cont=aa)\n\nmblst <- list(\n  'File load' = list(\n    'Load Catchment' = list(handler = loadCatchment,icon='open'),\n    'Load Data' = list(handler=loadData,icon=\"open\"),\n    'load Forecast' = list(handler = loadFore, icon = 'open')\n  ),\n  'Map' = list(\n    'Spatial Map Ob' = list(\n      'Mean Seasonal Preci' = list(handler = MeanSeasonal_Ob),\n      'Max' = list(handler = MaxSpatialMap_Ob),\n      'Mean Annual Preci' = list(handler = MeanAnnual_Ob)\n      ),\n    'Spatial Map Fo' = list(handler= SpatialMap_Fo)\n  ),\n  'Plot' = list(\n    'Precipitation Ob' = list(\n      'Catchment Preci' = list(handler = DPreci_Ob),\n      'AnnualMean Preci' = list(handler = AMPreci_Ob),\n      'AnnualSum Preci' = list(handler = ASPreci_Ob),\n      'AnnualMax Preci' = list(handler = AMaxPreci_Ob)\n      ),\n    'Precipitation Fr' = list(handler = DPreci_Fr)\n  ),\n  'Comparison' = list(\n    handler = DPreci_Fr\n  )\n)\n\ngmenu(mblst, cont=background)\n\n\n\n\n#Additional Code\n############################################################################################################################\n\n# ##showing whole spain\n# spain02Path <- \"C:/DHI_Projects/Seasonal_Forecasting/spain02Pr\"\n# spain02Files <- list.files(spain02Path, pattern = 'nc', full.names = TRUE)\n# spain02Pr=loadGridData(spain02Files[2], \"pr\", year = NULL,latLim=extLat, lonLim = extLon, dictionary=FALSE)\n# # \n# \n# getSpatialMap(spain02Pr,catchment,method = 'mean')\n# \n#JanuFo <- loadECOMS(dataset = 'System4_seasonal_15', var = 'tp', members = 1, lonLim = c(-5,-1), latLim = c(37,44), season = 1, years = 2000, leadMonth = 1, time = \"DD\")\n#ex2 <- loadECOMS(dataset = \"System4_seasonal_15\", var = \"tp\", members = 1:2, lonLim = c(-15,35), latLim = c(32, 75), season = c(12,1,2), years = 2001:2002, leadMonth = 3, time = \"DD\")\n\n# spain02Pr <- JanuFo\n# getSpatialMap(spain02Pr,catchment,method = 'meanAnnualPreci')\n\n\n#Additional Code2\n############################################################################################################################\n\n",
    "created" : 1433337906967.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1572148868",
    "id" : "4A032632",
    "lastKnownWriteTime" : 1426685643,
    "path" : "C:/DHI_Projects/11811405/Seasonal_Forecasting/R/Data_Analysis/Start_GUI.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}