{
    "contents" : "#' Get annual rainfall of different rainfall time series\n#' \n#' @param datalist A list containing different time series of different rainfall gauges\n#' @return The annual rainfall and the number of missing data of each year and each rainfall gauge, which \n#' will also be plotted.\n# @examples\n# str(datalist)\n# List of 5\n# $ AAA:'data.frame':  5602 obs. of  2 variables:\n#  ..$ Date: Factor w/ 5602 levels \"1999-10-28\",\"1999-10-29\",..: 1 2 3 4 5 6 7 8 9 10 ...\n# ..$ AAA : num [1:5602] 0 0 0.4 0 0.2 46.6 1.8 0 0 31.2 ...\n# $ BBB:'data.frame':  5977 obs. of  2 variables:\n#   ..$ Date: Date[1:5977], format: \"1999-01-01\" \"1999-01-02\" \"1999-01-03\" ...\n# ..$ BBB : num [1:5977] 0 1.4 0 0 0 0 0 19.7 42.9 4.7 ...\n# $ CCC:'data.frame':\t5977 obs. of  2 variables:\n#   ..$ Date: Date[1:5977], format: \"1999-01-01\" \"1999-01-02\" \"1999-01-03\" ...\n# ..$ CCC : num [1:5977] 0 0 0 0 0 0 0 11 28.6 6.2 ...\n# $ DDD:'data.frame':\t6307 obs. of  2 variables:\n#   ..$ Date: Factor w/ 6307 levels \"1998-01-01\",\"1998-01-02\",..: 1 2 3 4 5 6 7 8 9 10 ...\n# ..$ DDD : num [1:6307] NA NA NA NA NA NA NA NA NA NA ...\n# $ EEE:'data.frame':\t5977 obs. of  2 variables:\n#   ..$ Date: Date[1:5977], format: \"1999-01-01\" \"1999-01-02\" \"1999-01-03\" ...\n# ..$ EEE : num [1:5977] 0 0 0 0 0 0 0 16.2 30 9 ...\n# \n# a1 <- getAnnual(datalist)\n# \n# head(a1)\n# \n#   yearUnique name annualPreci NANum\n# 1       1999  AAA       480.4     5\n# 2       2000  AAA      2058.2    10\n# 3       2001  AAA      1441.1     0\n# 4       2002  AAA      2441.0    35\n# 5       2003  AAA      2072.8     0\n# 6       2004  AAA      1665.9    16\n# \n# tail(a1)\n# \n#    yearUnique name annualPreci NANum\n# 80       2010  EEE      1641.7     0\n# 81       2011  EEE      1886.2     0\n# 82       2012  EEE      1709.7     0\n# 83       2013  EEE      2581.6     0\n# 84       2014  EEE      2283.0     0\n# 85       2015  EEE       843.5     0\n#' @references\n#' Data source:\n#' http://meteo.navarra.es/estaciones/mapadeestaciones.cfm\n#' http://www4.gipuzkoa.net/oohh/web/esp/02.asp\n#' @export\n#' @import ggplot2 reshape2\ngetAnnual <- function(datalist){\n  \n  data <- lapply(datalist, FUN = getAnnual_dataframe)\n  \n  data <- do.call('rbind',data)\n  \n  rownames(data) <- NULL\n  \n  plotData <- melt(data, var.id = c('yearUnique','name'))\n  \n  mainLayer <- ggplot(plotData)+\n    geom_bar(aes(x = as.Date(yearUnique,format = '%Y'), y = value , fill = name), stat = 'identity')+\n    facet_grid(variable ~ name, scales = 'free')\n  print (mainLayer)\n  \n  return (data)\n}\n\n\n#' Get mean annual rainfall of different rainfall time series\n#' \n#' @param datalist A list containing different time series of different rainfall gauges\n#' @return The mean annual rainfall of each year and each rainfall gauge\n# @examples\n# str(datalist)\n# List of 5\n# $ AAA:'data.frame':  5602 obs. of  2 variables:\n#  ..$ Date: Factor w/ 5602 levels \"1999-10-28\",\"1999-10-29\",..: 1 2 3 4 5 6 7 8 9 10 ...\n# ..$ AAA : num [1:5602] 0 0 0.4 0 0.2 46.6 1.8 0 0 31.2 ...\n# $ BBB:'data.frame':  5977 obs. of  2 variables:\n#   ..$ Date: Date[1:5977], format: \"1999-01-01\" \"1999-01-02\" \"1999-01-03\" ...\n# ..$ BBB : num [1:5977] 0 1.4 0 0 0 0 0 19.7 42.9 4.7 ...\n# $ CCC:'data.frame':  5977 obs. of  2 variables:\n#   ..$ Date: Date[1:5977], format: \"1999-01-01\" \"1999-01-02\" \"1999-01-03\" ...\n# ..$ CCC : num [1:5977] 0 0 0 0 0 0 0 11 28.6 6.2 ...\n# $ DDD:'data.frame':\t6307 obs. of  2 variables:\n#   ..$ Date: Factor w/ 6307 levels \"1998-01-01\",\"1998-01-02\",..: 1 2 3 4 5 6 7 8 9 10 ...\n# ..$ DDD : num [1:6307] NA NA NA NA NA NA NA NA NA NA ...\n# $ EEE:'data.frame':\t5977 obs. of  2 variables:\n#   ..$ Date: Date[1:5977], format: \"1999-01-01\" \"1999-01-02\" \"1999-01-03\" ...\n# ..$ EEE : num [1:5977] 0 0 0 0 0 0 0 16.2 30 9 ...\n# \n# a <- getAnnual_mean(datalist)\n# a\n#   name    meanV\n# 1  AAA 2017.300\n# 2  BBB 2373.287\n# 3  CCC 2145.075\n# 4  DDD 1680.593\n# 5  EEE 1928.640\n\n#' @references\n#' Data source:\n#' http://meteo.navarra.es/estaciones/mapadeestaciones.cfm\n#' http://www4.gipuzkoa.net/oohh/web/esp/02.asp\n#' @export\ngetAnnual_mean <- function(datalist){\n  data <- lapply(datalist, FUN = getAnnual_dataframe, output = 'mean')\n  data <- do.call('rbind',data)\n  rownames(data) <- NULL\n  \n  return (data)\n}\n\n\n\n\n#' Get annual rainfall of the input time series.\n#' \n#' @param dataset A dataframe containing one time series, e.g., rainfall from one gauging station.\n#' @param output A string showing what kind of output is, e.g. 'series' or 'mean'\n#' @return The annual rainfall of each year of the input station.\n# @examples\n# \n# #a is a time series.\n# head(a)\n#         Date  AAA\n# 1 1999-10-28  0.0\n# 2 1999-10-29  0.0\n# 3 1999-10-30  0.4\n# 4 1999-10-31  0.0\n# 5 1999-11-01  0.2\n# 6 1999-11-02 46.6\n# \n# tail(a)\n#            Date   AAA\n# 5597 2015-02-22  18.4\n# 5598 2015-02-23  32.8\n# 5599 2015-02-24  53.6\n# 5600 2015-02-25 132.5\n# 5601 2015-02-26 113.1\n# 5602 2015-02-27  20.0\n# \n# \n# a1 <- getAnnual_dataframe(a, output = 'series')\n# a1\n#      yearUnique name annualPreci NANum\n# 1999       1999  AAA       480.4     5\n# 2000       2000  AAA      2058.2    10\n# 2001       2001  AAA      1441.1     0\n# 2002       2002  AAA      2441.0    35\n# 2003       2003  AAA      2072.8     0\n# 2004       2004  AAA      1665.9    16\n# 2005       2005  AAA      1960.7     0\n# 2006       2006  AAA      1566.6     0\n# 2007       2007  AAA      2094.3     0\n# 2008       2008  AAA      2357.1     0\n# 2009       2009  AAA      2111.9     0\n# 2010       2010  AAA      1657.5     0\n# 2011       2011  AAA      2072.6     0\n# 2012       2012  AAA      1758.9     0\n# 2013       2013  AAA      2614.0     0\n# 2014       2014  AAA      2459.2     0\n# 2015       2015  AAA       951.8     0\n\n#' @references\n#' Data source:\n#' http://meteo.navarra.es/estaciones/mapadeestaciones.cfm\n#' http://www4.gipuzkoa.net/oohh/web/esp/02.asp\n#' @export\ngetAnnual_dataframe <- function(dataset, output = 'series'){\n  Date <- as.Date(dataset[,1])\n  year <- format(Date,'%Y')\n  yearUnique <- unique(year)\n  calcuNum <- c(1: length(yearUnique))\n  \n  NANum <- length(which(is.na(dataset[,2])))\n  \n  annualPreci <- tapply(dataset[,2], INDEX = year, FUN = sum, na.rm = T)\n  NANum <- tapply(dataset[,2], INDEX = year, function(x) length(which(is.na(x))))\n  \n  \n  firstYearN <- length(which(year == year[1]))\n  if (firstYearN < 360) calcuNum[1] <- NA \n  \n  lastYearN <- length(which(year == year[length(year)]))\n  if (lastYearN < 360) calcuNum[length(yearUnique)] <- NA\n  \n  calcuNum[which(NANum > 10)] <- NA\n  \n  meanV <- mean(annualPreci[which(!is.na(calcuNum))])\n  \n  if (output == 'mean'){\n    name <- colnames(dataset)[2]\n    output <- data.frame(name,meanV)\n    return (output)\n  }else if(output == 'series'){\n    name <- rep(colnames(dataset)[2],length(calcuNum))\n    output <- data.frame(yearUnique,name,annualPreci,NANum)\n    return (output)\n  }\n  \n}\n\n\n",
    "created" : 1434493201334.000,
    "dirty" : false,
    "encoding" : "ASCII",
    "folds" : "",
    "hash" : "2006452852",
    "id" : "2BDE4401",
    "lastKnownWriteTime" : 1434493870,
    "path" : "~/hyfo/R/getAnnual.R",
    "project_path" : "R/getAnnual.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}