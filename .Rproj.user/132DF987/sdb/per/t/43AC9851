{
    "contents" : "#' collect data from different txt.\n#' \n#' @param folderName A string showing the folder path.\n#' @param output A boolean showing whether the result is given.\n#' @param rangeWord A list containing the keyword and the shift. \n#' defaut is set to be used in spain gauging station.\n#' @examples\n#'   \n#' #use internal data as an example.\n#' \n#' file <- system.file(\"extdata\", \"1999.csv\", package = \"hyfo\")\n#' folder <- strsplit(file, '1999')[[1]][1]\n#' a <- collectData_txt_anarbe(folder)\n#' \n#' # More examples can be found in the user manual on http://yuanchao-xu.github.io/hyfo/\n#' \n#' @references \n#' \n#' \\itemize{\n#' \\item http://www4.gipuzkoa.net/oohh/web/esp/02.asp\n#' \\item R Core Team (2015). R: A language and environment for statistical computing. R Foundation for\n#' Statistical Computing, Vienna, Austria. URL http://www.R-project.org/.\n#' }\n#' \n#' \n#' @source http://www4.gipuzkoa.net/oohh/web/esp/02.asp\n#' @return The collected data from different txt files.\n#' @export\n#' @importFrom utils tail\ncollectData_txt_anarbe <- function(folderName, output = TRUE, rangeWord = c('Ene       ', -1, \n                                                                   'Total     ', -6)){\n  #All the code should be ASCII encode, so there should be no strange symbol.\n  if (is.null(rangeWord)) {\n    stop('rangeWord consists of 4 elements:\n          1. start word which program can recognise.\n          2. shift1, the shift needs to be made. E.g. start word is in line 7, and program\n          should read file from line 9, then shift is 9-7 = 2.\n          3. end word, as start word\n          4. shift2, same as shift1, sometimes can be negative\n          \n          E.g. rangeWord=c(\\\"aaa\\\",2,\\\"bbb\\\",-2)\n         if no rangeWord, just input c(NULL,NULL,NULL,NULL)')\n  \n  }\n  \n\n  fileNames <- list.files(folderName, pattern = '*.TXT', full.names = TRUE)\n  \n  data <- lapply(fileNames, FUN = readColumn_txt_anarbe, rangeWord = rangeWord)\n  \n  data <- do.call('rbind', data)\n  \n  a <- unlist(strsplit(folderName, '\\\\\\\\|/'))\n  tarName <- tail(a, 2)[1]\n  colnames(data) <- c('Date', tarName)\n  \n  #newFileName <- file.choose(new = T)\n  message('new file should be located a different location than the excel folder,\n         in order to avoid error.\n         At least 2 excels should be in the folder')\n  \n  #write.table(data_new,file=newFileName,row.names = F, col.names = F,sep=',')\n  \n  \n  if (output == TRUE) return(data)\n\n}  \n\n\n\nanarbe_txt <- function(dataset, x1, x2){\n  \n  data <- as.matrix(dataset[x1:x2, 2:13])\n  startYear <- data[1, 6]\n  \n  data <- data[5:35, ]\n  \n  date <- which(data != '          ', arr.ind = TRUE)\n  startDate <- date[1, ]\n  \n  endDate <- date[length(date[, 1]), ]\n  \n  startDate <- as.Date(paste(startYear, startDate[2], startDate[1], sep = '-'))\n  endDate <- as.Date(paste(startYear, endDate[2], endDate[1], sep = '-'))\n  \n  Date <- as.factor(seq(startDate, endDate, 1))\n  \n  dim(data) <- c(length(data), 1)\n  \n  data <- as.numeric(data[which(data != '          '), ])\n  \n  if (length(data) != length(Date)) {\n    stop('check original txt file. for missing value, the symbol is \"--\", check\n         if this symbol is missing somewhere')\n  }\n  \n  output <- data.frame(Date = Date, target = data)\n  \n  return(output)\n  }\n\n#' @references \n#' \n#' \\itemize{\n#' \\item R Core Team (2015). R: A language and environment for statistical computing. R Foundation for\n#' Statistical Computing, Vienna, Austria. URL http://www.R-project.org/.\n#' }\n#' \n#' @importFrom utils read.fwf\nreadColumn_txt_anarbe <- function(fileName, keyword = NULL, rangeWord = NULL){\n  \n  a <- read.fwf(fileName, widths = rep(10,13))#read file with fixed width\n  \n  startRow <- which(a == rangeWord[1], arr.ind = TRUE)[, 1]\n  startRow <- startRow + as.numeric(rangeWord[2])\n  \n  endRow <- which(a == rangeWord[3], arr.ind = TRUE)[, 1]\n  endRow <- endRow + as.numeric(rangeWord[4])\n  \n  data <- mapply(FUN=function(x1, x2) anarbe_txt(dataset = a, x1, x2), startRow, endRow)\n  \n  data_new <- data.frame(Data = unlist(data[1, ]), target = unlist(data[2, ]))\n  message(fileName)\n  return(data_new)\n}\n",
    "created" : 1443188932441.000,
    "dirty" : false,
    "encoding" : "ASCII",
    "folds" : "",
    "hash" : "1337281998",
    "id" : "43AC9851",
    "lastKnownWriteTime" : 1443188941,
    "path" : "~/hyfo/R/collectData_txt.R",
    "project_path" : "R/collectData_txt.R",
    "properties" : {
    },
    "relative_order" : 12,
    "source_on_save" : false,
    "type" : "r_source"
}