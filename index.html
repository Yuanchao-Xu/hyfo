<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Hyfo by Yuanchao-Xu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Hyfo</h1>
      <h2 class="project-tagline">Hydrological and Forecasting Tools</h2>
      <a href="https://github.com/Yuanchao-Xu/hyfo" class="btn">View on GitHub</a>
      <a href="https://github.com/Yuanchao-Xu/hyfo/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Yuanchao-Xu/hyfo/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="hyfo" class="anchor" href="#hyfo" aria-hidden="true"><span class="octicon octicon-link"></span></a>hyfo</h1>

<h4>
<a id="is-designed-for-hydrology-and-forecasting-anaylasis-containing-a-number-of-tools-including-data-extration-data-processing-and-data-visulization-there-are-two-main-parts-in-the-package-as-well-as-in-this-mannual" class="anchor" href="#is-designed-for-hydrology-and-forecasting-anaylasis-containing-a-number-of-tools-including-data-extration-data-processing-and-data-visulization-there-are-two-main-parts-in-the-package-as-well-as-in-this-mannual" aria-hidden="true"><span class="octicon octicon-link"></span></a>is designed for hydrology and forecasting anaylasis, containing a number of tools including data extration, data processing and data visulization. There are two main parts in the package, as well as in this mannual:</h4>

<ol>
<li>Hydrology</li>
<li>Providing tools from raw data extration to final precipitation data used by model.</li>
<li><p>e.g., data extraction from file, precipitation gap filler, annual precipitation calculation.</p></li>
<li><p>Forecasting</p></li>
<li>Providing tools from forecasting data visulization and analysis.</li>
<li>e.g., get spatial maps, data analysis and bias analysis.</li>
</ol>

<h5>
<a id="note" class="anchor" href="#note" aria-hidden="true"><span class="octicon octicon-link"></span></a>Note</h5>

<ul>
<li><p>For the forecasting tools part, <code>hyfo</code> mainly focuses on the post processing of the gridData derived from forecasts or other sources. The input is a list file, usually a result from  <code>loadGridData{ecomsUDG.Raccess}</code> or <code>loadECOMS{ecomsUDG.Raccess}</code>. Pacakage<code>{ecomsUDG.Raccess}</code>is designed for getting access to different dataset, and also can load grid file (like netcdf file) directly.</p></li>
<li><p>The functions end with <code>_anarbe</code> are the functions designed specially for some case in Spain, those functions mostly are about data collection of the anarbe catchment, which will be introduced in the end fo this mannual.</p></li>
</ul>

<h1>
<a id="content" class="anchor" href="#content" aria-hidden="true"><span class="octicon octicon-link"></span></a>Content</h1>

<ol>
<li>Hydrology

<ul>
<li>1.1 Data Preparation

<ul>
<li>1.1.1 From File</li>
<li>1.1.2 Mannually</li>
</ul>
</li>
<li>1.2 Rainfall Analysis</li>
<li>1.3 Extract Common Period from Different Time Series</li>
<li>1.4 Fill Gaps (rainfall data gaps)</li>
<li>1.5 Seasonal and Monthly Precipitation</li>
</ul>
</li>
<li>Forecasting

<ul>
<li>2.1 Plot Spatial Map</li>
<li>2.2 Add Background (catchment and gauging stations)

<ul>
<li>2.2.1 Add catchment shape file.</li>
<li>2.2.2 Add station locations</li>
</ul>
</li>
<li>2.3 Precipitation Bar Plot</li>
<li>2.4 Analysis and Comparison

<ul>
<li>2.4.1 Spatial Map</li>
<li>2.4.2 Bar Plot</li>
</ul>
</li>
</ul>
</li>
<li>Anarbe Case</li>
</ol>

<h1>
<a id="1-hydrology" class="anchor" href="#1-hydrology" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Hydrology</h1>

<h5>
<a id="note-1" class="anchor" href="#note-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Note</h5>

<p>If you are an experienced R user, and know how to read data in R, deal with dataframe, generate date and list, please start from next charpter, "1.2 Rainfall Analysis"</p>

<h2>
<a id="11-data-preparation" class="anchor" href="#11-data-preparation" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.1 Data Preparation</h2>

<h3>
<a id="111-from-file" class="anchor" href="#111-from-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.1.1 From File</h3>

<p><code>hyfo</code> does provide a common tool for collecting data from different type of files, including "txt", </p>

<p>"csv" and "excel", which has to be assigned to the argument <code>fileType</code>.</p>

<p>Now let's use internal data as an example.</p>

<div class="highlight highlight-r"><pre>library(<span class="pl-smi">hyfo</span>)<span class="pl-c">#load the package.</span>
<span class="pl-c"># get the folder containing different csv (or other type) files.</span>
<span class="pl-smi">file</span> <span class="pl-k">&lt;-</span> system.file(<span class="pl-s"><span class="pl-pds">"</span>extdata<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>1999.csv<span class="pl-pds">"</span></span>, <span class="pl-v">package</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>hyfo<span class="pl-pds">"</span></span>)
<span class="pl-smi">folder</span> <span class="pl-k">&lt;-</span> strsplit(<span class="pl-smi">file</span>, <span class="pl-s"><span class="pl-pds">'</span>1999<span class="pl-pds">'</span></span>)[[<span class="pl-c1">1</span>]][<span class="pl-c1">1</span>]

<span class="pl-c"># Extract and combine content from different files and in each file, the extracted zone is </span>
<span class="pl-c"># from row 10 to row 20, Column 1 to column2.</span>
<span class="pl-smi">a</span> <span class="pl-k">&lt;-</span> collectData(<span class="pl-smi">folder</span>, <span class="pl-v">fileType</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>csv<span class="pl-pds">'</span></span>, <span class="pl-v">range</span> <span class="pl-k">=</span> c(<span class="pl-c1">10</span>, <span class="pl-c1">20</span>, <span class="pl-c1">1</span>, <span class="pl-c1">2</span>))
str(<span class="pl-smi">a</span>)</pre></div>

<p><code>a</code> cannot be directly inputed in <code>hyfo</code>, it still needs some process.</p>

<div class="highlight highlight-r"><pre><span class="pl-c"># Check the date to see if it follows the format in ?as.Date(), if not, </span>
<span class="pl-c"># use as.Date to convert. </span>
<span class="pl-smi">a</span> <span class="pl-k">&lt;-</span> <span class="pl-k">data.frame</span>(<span class="pl-smi">a</span>)
<span class="pl-c">#get date</span>
<span class="pl-smi">date</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">a</span>[, <span class="pl-c1">1</span>]

<span class="pl-c"># The original format is d/m/year, convert to formal format.</span>
<span class="pl-smi">date</span> <span class="pl-k">&lt;-</span> as.Date(<span class="pl-smi">date</span>, <span class="pl-v">format</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>%d/%m/%Y<span class="pl-pds">'</span></span>)
<span class="pl-smi">a</span>[, <span class="pl-c1">1</span>] <span class="pl-k">&lt;-</span> <span class="pl-smi">date</span>

<span class="pl-c"># Now a has become `a` time series dataframe, which is the atom element of the analysis. </span>
<span class="pl-c">#`hyfo` deals with list containing different time series dataframe. In this example, </span>
<span class="pl-c">#there is only one dataframe, and more examples please refer to the following chapter.</span>
<span class="pl-smi">datalist</span> <span class="pl-k">&lt;-</span> <span class="pl-k">list</span>(<span class="pl-smi">a</span>)

<span class="pl-c"># Use getAnnual as an example, here since `a` is not a complete time series, </span>
<span class="pl-c"># the result is only base on the input.</span>
<span class="pl-c"># getAnnual gives the annual precipitation of each year, </span>
<span class="pl-c"># and will be introduced in the next chapter.</span>
getAnnual(<span class="pl-smi">datalist</span>)</pre></div>

<h3>
<a id="112-mannually" class="anchor" href="#112-mannually" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.1.2 Mannually</h3>

<p>Following example shows a simple way to generate dataframe with start date, end date, and the value. Here in the example, <code>sample()</code> is used to generate random values, while in real case it will be a vector containing time series values.</p>

<pre lang="r,"><code># Generate timeseries datalist. Each data frame consists of a Date and a value.
library(hyfo)
AAA &lt;- data.frame(
  Date = seq(as.Date('1990-10-28'), as.Date('1997-4-1'), 1), # Date column
  AAA = sample(1:10, length(seq(as.Date('1990-10-28'), # value column
                                as.Date('1997-4-1'), 1)), repl = TRUE))

BBB &lt;- data.frame(
  Date = seq(as.Date('1993-3-28'), as.Date('1999-1-1'),1), 
  BBB = sample(1:10, length(seq(as.Date('1993-3-28'), 
                                as.Date('1999-1-1'),1)), repl = TRUE))

CCC &lt;- data.frame(
  Date = seq(as.Date('1988-2-2'), as.Date('1996-1-1'),1), 
  CCC = sample(1:10, length(seq(as.Date('1988-2-2'), 
                                as.Date('1996-1-1'),1)), repl = TRUE)) 

datalist &lt;- list(AAA, BBB, CCC)# dput() and dget() can be used to save and load list file.
a &lt;- getAnnual(datalist)
</code></pre>

<h2>
<a id="12-rainfall-analysis" class="anchor" href="#12-rainfall-analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.2 Rainfall Analysis</h2>

<p>Assuming we have three gauging stations named "AAA", "BBB", "CCC", the precipitation information can be get by the following:</p>

<pre lang="r,"><code># testdl is a datalist provided by the package as a test. 
# It's a list containing different time series.
data(testdl)
a &lt;- getAnnual(testdl)
</code></pre>

<p>As shown above, the annual precipitation and the number of missing values are shown in the figure. Knowing how many missing values you have is alway important when calculating the mean annual precipitation. </p>

<p>Now we want to get the mean annual precipitation.</p>

<pre lang="r,"><code>a &lt;- getAnnual(testdl, output = 'mean')
a
</code></pre>

<p>Mean annual precipitation is calculated, but as we can see in the figure before, it's not reliable, since there are a lot of missing values in AAA and CCC, especially in AAA, in 1993, there are more than 30 missing values in a year. So we have to decide which is the threshold for the valid record. the default is 355, which means in a year (355 or 365 days), if the valid records (not missing) exceeds 355, then this year is taken into consideration in the mean annual preicipitation calculation.</p>

<pre lang="r,"><code>getAnnual(testdl, output = 'mean', minRecords = 300)
getAnnual(testdl, output = 'mean', minRecords = 365)
</code></pre>

<p>If you are not satisfied with the title and x axis and y axis, you can assign them yourself.</p>

<pre lang="r,"><code>a &lt;- getAnnual(testdl, output = 'mean', title = 'aaa', x = 'aaa', y = 'aaa')
</code></pre>

<p>If you want to calculate annual rainfall for a single dataframe containing one time series.</p>

<pre lang="r,"><code>a &lt;- getAnnual_dataframe(testdl[[1]])
a
</code></pre>

<h2>
<a id="13-extract-common-period-from-different-time-series" class="anchor" href="#13-extract-common-period-from-different-time-series" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.3 Extract Common Period from Different Time Series</h2>

<p>Now we have the general information of the precipitation, if we want to use them in a model, we have to extract the common period of them, and use the common period precipitation to analyze.</p>

<pre lang="r,"><code>testdl_new &lt;- extractPeriod(testdl, commonPeriod = TRUE )
str(testdl_new)
</code></pre>

<p>If we want to extract data from a certain period, we can assgin start and end date.</p>

<pre lang="r,"><code># Extract period of the winter of 1994
testdl_new &lt;- extractPeriod(testdl, startDate = '1994-12-01', endDate = '1995-03-01' )
str(testdl_new)
</code></pre>

<h2>
<a id="14-fill-gaps-rainfall-data-gaps" class="anchor" href="#14-fill-gaps-rainfall-data-gaps" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.4 Fill Gaps (rainfall data gaps)</h2>

<p>Although we have got the precipitation of the common period, we can still see that there are some missing values inside, which we should fill.</p>

<pre lang="r,"><code>testdl_new &lt;- extractPeriod(testdl, commonPeriod = TRUE )
a &lt;- getAnnual(testdl_new)
a
</code></pre>

<p>First we have to transform the datalist to dataframe, which can be done by the code below:</p>

<pre lang="r,"><code>df &lt;- list2Dataframe(testdl_new)
head(df)
</code></pre>

<p>From above, we can see that in the gauging station "AAA", there are some missing value marked as "NA". Now we are going to fill these gaps.</p>

<p>The gap filling is based on the correlation and linear regression between each two gauging stations, correlation table, correlation Order and Linear Coefficients are also printed when doing the calculation. Details can be found in  <code>?fillGap</code>.</p>

<pre lang="r,"><code>df_filled &lt;- fillGap(df)
head(df_filled)
</code></pre>

<p>Default correlation period is "daily", while sometimes the daily rainfall correlation of precipitation is not so strong, we can also select the correlation period.</p>

<pre lang="r,"><code>df_filled &lt;- fillGap(df, corPeriod = 'monthly')
head(df_filled)
df_filled &lt;- fillGap(df, corPeriod = 'yearly')
head(df_filled)
</code></pre>

<h2>
<a id="15-seasonal-and-monthly-precipitation" class="anchor" href="#15-seasonal-and-monthly-precipitation" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.5 Seasonal and Monthly Precipitation</h2>

<p>Sometimes we need to know not only the annual precipitation, but also the precipitation of a certain month or certain season.</p>

<pre lang="r,"><code>data(testdl)
# year and mon can be extracted from date.
TS  &lt;- testdl[[1]]
year = as.numeric(format(TS[, 1], '%Y'))
month = as.numeric(format(TS[, 1], '%m'))
</code></pre>

<p>Get the mean spring precipitation.</p>

<pre lang="r,"><code>a &lt;- getMeanPreci(TS[, 2], method = 'spring', yearIndex = year, monthIndex = month)
a
</code></pre>

<p>Get the series of spring precipitation, set <code>fullResults = TRUE</code>.</p>

<pre lang="r,"><code>a &lt;- getMeanPreci(TS[, 2], method = 'spring', yearIndex = year, monthIndex = month,
                  fullResults = TRUE)
a
</code></pre>

<p>If missing value is excluded, set omitNA = TRUE.</p>

<pre lang="r,"><code>a &lt;- getMeanPreci(TS[, 2], method = 'winter', yearIndex = year, monthIndex = month,
                  omitNA = TRUE, fullResults = TRUE)
a
</code></pre>

<p>Get special month precipitation, e.g. march.</p>

<pre lang="r,"><code>a &lt;- getMeanPreci(TS[, 2], method = 3, yearIndex = year, monthIndex = month,
                  fullResults = TRUE)
a
</code></pre>

<p>We can also get annual precipitation.</p>

<pre lang="r,"><code>a &lt;- getMeanPreci(TS[, 2], method = 'annual', yearIndex = year, monthIndex = month,
                  fullResults = TRUE)
</code></pre>

<h1>
<a id="2-forecasting" class="anchor" href="#2-forecasting" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Forecasting</h1>

<h5>
<a id="note-2" class="anchor" href="#note-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Note</h5>

<p>If an ensemble forecasting data is loaded, there will be one dimension called  "member", by default, <code>hyfo</code> will calculate the mean of different members. If you want to see a special member, add <code>member</code> argument to <code>getSpatialMap</code>, e.g., <code>getSpatialMap(tgridData, method = 'meanAnnual', member = 3)</code>, <code>getPreciBar(tgridData, method = 'annual', member = 14)</code></p>

<h2>
<a id="21-plot-spatial-map" class="anchor" href="#21-plot-spatial-map" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.1 Plot Spatial Map</h2>

<p>As described at the start of the mannual, <code>hyfo</code> is mainly in charge of the post processing of the forecast data. Input of <code>hyfo</code> should be the result from  <code>loadGridData{ecomsUDG.Raccess}</code> or <code>loadECOMS{ecomsUDG.Raccess}</code>. An example is included in the package. </p>

<p>If we want to see the mean daily precipitation.</p>

<pre lang="r,"><code>data(tgridData)
a &lt;- getSpatialMap(tgridData, method = 'meanAnnual')
</code></pre>

<p>There are several methods to be seleted in the function, details can be found by <code>?getSpatialMap</code>.</p>

<p>Sometimes there exists a great difference in the whole map, e.g., the following value, <code>c(100, 2, 2,6, 1,7)</code>, since the maximum value is too large, so in the plot, by normal plot scale, we can only recognize value 100 and the rest, it's hard for us to tell the difference between 2, 2.6, and 1.7 from the plot. In this situation, the value needs to be processed before plotting. Here <code>scale</code> provides a way to decide the plot scale.</p>

<p><code>scale</code> passes the arguments to the <code>trans</code> argument in <code>ggplot2</code>. The most common scale is "sqrt" and "log10", which focus more on the minutiae. Default is "identity", which means no change to the plot scale.</p>

<pre lang="r,"><code>a &lt;- getSpatialMap(tgridData, method = 'meanAnnual', scale = 'sqrt')
</code></pre>

<p>Here in our example, because the region is too small, and the differences is not so big, so it's not so obvious to tell from the plot. But if in a map, both dry region and wet region is included, that will be more obvious to see the difference between the plot scales.</p>

<p>Also, if you are not satisfied with the title, x axis and y axis, you can assgin yourself.</p>

<pre lang="r,"><code>a &lt;- getSpatialMap(tgridData, method = 'meanAnnual', scale = 'sqrt', 
                   title = 'aaa', x = 'aaa', y = 'aaa')
</code></pre>

<h2>
<a id="22-add-background-catchment-and-gauging-stations" class="anchor" href="#22-add-background-catchment-and-gauging-stations" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2 Add Background (catchment and gauging stations)</h2>

<p>The default background is the world map, while if you have other backgrounds like catchment shape file and station location file, you are welcome to import them as background.</p>

<h3>
<a id="221-add-catchment-shape-file" class="anchor" href="#221-add-catchment-shape-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2.1 Add catchment shape file</h3>

<p>Catchment shape file needs to be processed with a very simple step. It's based on the package <code>rgdal</code>, details can be found by <code>?shp2cat</code></p>

<pre lang="r,"><code># Use the test file provided by hyfo
file &lt;- system.file("extdata", "testCat.shp", package = "hyfo")
cat &lt;- shp2cat(file)
# cat is the catchment file.
</code></pre>

<p>Then the catchment file <code>cat</code> can be inputed as background.</p>

<pre lang="r,"><code>a &lt;- getSpatialMap(tgridData, method = 'meanAnnual', catchment = cat)
</code></pre>

<h3>
<a id="222-add-station-locations" class="anchor" href="#222-add-station-locations" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2.2 Add station locations</h3>

<p>Points file needs to be read into dataframe, and special column has to be assigned, details can be found by <code>?getSpatialMap_mat</code></p>

<pre lang="r,"><code># Use the points file provided by hyfo
file &lt;- system.file("extdata", "points.txt", package = "hyfo")
points &lt;- read.table(file, header = TRUE, sep = ',' )
getSpatialMap(tgridData, method = 'winter', points = points, catchment = cat)

</code></pre>

<p>As can be seen above, the color of the points represents the elevation, the size of the points represents the value, e.g., rainfall value.</p>

<h2>
<a id="23-precipitation-bar-plot" class="anchor" href="#23-precipitation-bar-plot" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.3 Precipitation Bar Plot</h2>

<p>Bisides spatial map, bar plot can also be plotted. The value in the bar plot is spatially averaged, i.e. the value in the bar plot is the mean value over the region.</p>

<p>Annual precipitation.</p>

<pre lang="r,"><code>data(tgridData)
a &lt;- getPreciBar(tgridData, method = 'annual')
</code></pre>

<p>Mean monthly precipitation over the whole period, with the ranges for each month. But not all kinds of bar plot have a plot range.</p>

<pre lang="r,"><code>a &lt;- getPreciBar(tgridData, method = 'meanMonthly')
a &lt;- getPreciBar(tgridData, method = 'meanMonthly', plotRange = FALSE)
</code></pre>

<p>Seasonal precipitation, and monthly precipitation can also be plotted. </p>

<pre lang="r,"><code>a &lt;- getPreciBar(tgridData, method = 'spring')# spring precipitation for each year
a &lt;- getPreciBar(tgridData, method = 3) # march precipitation for each year
</code></pre>

<h2>
<a id="24-analysis-and-comparison" class="anchor" href="#24-analysis-and-comparison" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.4 Analysis and Comparison</h2>

<p>For some cases, analysis and comparison are necesssary, which are also provided by <code>hyfo</code>. </p>

<p>There are three different kinds of output from <code>getSpatialMap</code> and <code>getPreciBar</code>, respectively, <code>output = 'data'</code>, <code>output = 'ggplot'</code> and <code>output = 'plot'</code>. </p>

<p><code>output = 'data'</code> is default in the function and do not need to be declare when input. It is mainly used in analyzing and replot the results.</p>

<p><code>output = 'ggplot'</code> is used when combining different plots.</p>

<p><code>output = 'plot'</code> is used when a layer output is needed. the output can be directly printed, and can be mannually combined by the plot arrange functions, e.g., <code>grid.arrange()</code></p>

<h5>
<a id="note-3" class="anchor" href="#note-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Note:</h5>

<p><strong>All the comparisons must be comparable, e.g.,</strong></p>

<ul>
<li>For <code>getSpatialMap_comb</code>, the maps to be compared should be with same size and resolution, in other words, they should be fully overlapped by each other. Check <code>?getSpatialMap_comb</code> for details.</li>
<li>For <code>getPreciBar_comb</code>, the bar plots to be compared should belong to the same kind, e.g., spring and winter, January and December, and couldn't be spring and annual. Details can be found by <code>?getPreciBar_comb</code>
</li>
</ul>

<h3>
<a id="241-spatial-map" class="anchor" href="#241-spatial-map" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.4.1 Spatial Map</h3>

<p>The default "data" output provides a matrix, representing the raster information of the spatial map. </p>

<pre lang="r,"><code>a &lt;- getSpatialMap(tgridData, method = 'meanAnnual')
a
</code></pre>

<p>This matrix is upside down from what you can see from the plot. <strong>DO NOT try to change this matrix.</strong>
<code>hyfo</code> can deal with it.</p>

<pre lang="r,"><code># For re-plot the matrix
b &lt;- getSpatialMap_mat(a)

# Without title and x and y, also you can assign yourself.
b &lt;- getSpatialMap_mat(a, title = 'aaa', x = 'aaa', y = '')
</code></pre>

<p>The matrix can be used to make different analysis and plot again.</p>

<h5>
<a id="note-4" class="anchor" href="#note-4" aria-hidden="true"><span class="octicon octicon-link"></span></a>Note</h5>

<p><strong>If the matrix doesn't come from <code>getSpatialMap</code>, dimension name of longitude and latitude needs to be provided to the matrix, in order to be plotted.</strong></p>

<pre lang="r,"><code>
a1 &lt;- getSpatialMap(tgridData, method = 'mean')
a2 &lt;- getSpatialMap(tgridData, method = 'max')

# To see the difference between mean value and maximum value.
b &lt;- a2 - a1
getSpatialMap_mat(b, title = '', x = '', y = '')

# To make some changes to mean value.
b &lt;- a1 * 3 -1
getSpatialMap_mat(b, title = '', x = '', y = '')

# Bias, variation and other analysis can also be processed 
# the same way. 
# Just apply the analysis to the matrix and 
# use getSpatialMap_mat to plot.
</code></pre>

<p>If multi-plot is needed, <code>hyfo</code> can also combine different plots together. Use <code>output = ggplot</code>, which gives back the a special format that can be easily used by <code>ggplot2</code></p>

<pre lang="r,"><code>
a1 &lt;- getSpatialMap(tgridData, method = 'spring', output = 'ggplot')
a2 &lt;- getSpatialMap(tgridData, method = 'summer', output = 'ggplot')
a3 &lt;- getSpatialMap(tgridData, method = 'meanAnnual', output = 'ggplot')
a4 &lt;- getSpatialMap(tgridData, method = 'winter', output = 'ggplot')

</code></pre>

<pre lang="r,"><code>
getSpatialMap_comb(a1, a2, a3, a4, nrow = 2)# you cannot assign title
getSpatialMap_comb(a1, a2, a3, a4, nrow = 4)

</code></pre>

<p><code>getSpatialMap_comb</code> accepts list (using <code>list =</code>) object too, which is easier for multi-plot. First list of 12 months are got.</p>

<pre lang="r,"><code>c &lt;- lapply(1:12, function(x) getSpatialMap(tgridData, method = x, output = 'ggplot') )
</code></pre>

<p>Then they are combined.</p>

<pre lang="r,"><code>getSpatialMap_comb(list = c, nrow = 4)
</code></pre>

<h3>
<a id="242-bar-plot" class="anchor" href="#242-bar-plot" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.4.2 Bar Plot</h3>

<p>Basically, bar plot follows the same rule as part 2.4.1 spatial map, only a few cases that needs to pay attention.</p>

<pre lang="r,"><code>b1 &lt;- getPreciBar(tgridData, method = 'spring', output = 'ggplot')
b2 &lt;- getPreciBar(tgridData, method = 'summer', output = 'ggplot')
b3 &lt;- getPreciBar(tgridData, method = 'autumn', output = 'ggplot')
b4 &lt;- getPreciBar(tgridData, method = 'winter', output = 'ggplot')
</code></pre>

<pre lang="r,"><code>getPreciBar_comb(b1, b2, b3, b4, nrow = 2)
</code></pre>

<pre lang="r,"><code>c &lt;- lapply(1:12, function(x) getPreciBar(tgridData, method = x, output = 'ggplot') )
</code></pre>

<pre lang="r,"><code>getPreciBar_comb(list = c, nrow = 4)
</code></pre>

<h2>
<a id="3-anarbe-case" class="anchor" href="#3-anarbe-case" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Anarbe Case</h2>

<p>The functions with anarbe case end with <code>_anarbe</code>, all of them are used to collect different available published data in anarbe catchment in Spain. The data comes from two website: <a href="http://meteo.navarra.es/estaciones/mapadeestaciones.cfm">linked phrase</a> and <a href="http://www4.gipuzkoa.net/oohh/web/esp/02.asp">linked phrase</a>, there are precipitation or discharge data on those website, and can be downloaded directly. </p>

<p>Since the available files on those website are arranged by a year or five years, for long term data collection, a tools is necessary for collecting data from different files.</p>

<h5>
<a id="note-5" class="anchor" href="#note-5" aria-hidden="true"><span class="octicon octicon-link"></span></a>Note:</h5>

<p>For excel files, if you have access to the dam regulation excel file of the dam anarbe, you can use  <code>collectData_excel_anarbe</code> in the package, but this function is commented in the original code, cannot be used directly. Go to original file in the library or go to github <a href="https://github.com/Yuanchao-Xu/hyfo/blob/master/R/collectData_excel.R">linked phrase</a>, copy the original code.</p>

<p>There are two csv files and txt files included in the package, which can be used as examples.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">file</span> <span class="pl-k">&lt;-</span> system.file(<span class="pl-s"><span class="pl-pds">"</span>extdata<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>1999.csv<span class="pl-pds">"</span></span>, <span class="pl-v">package</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>hyfo<span class="pl-pds">"</span></span>)
<span class="pl-smi">folder</span> <span class="pl-k">&lt;-</span> strsplit(<span class="pl-smi">file</span>, <span class="pl-s"><span class="pl-pds">'</span>1999<span class="pl-pds">'</span></span>)[[<span class="pl-c1">1</span>]][<span class="pl-c1">1</span>]

<span class="pl-smi">a</span> <span class="pl-k">&lt;-</span> collectData_csv_anarbe(<span class="pl-smi">folder</span>, <span class="pl-v">output</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
str(<span class="pl-smi">a</span>)
<span class="pl-smi">b</span> <span class="pl-k">&lt;-</span> collectData_txt_anarbe(<span class="pl-smi">folder</span>, <span class="pl-v">output</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
str(<span class="pl-smi">b</span>)</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Yuanchao-Xu/hyfo">Hyfo</a> is maintained by <a href="https://github.com/Yuanchao-Xu">Yuanchao-Xu</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

